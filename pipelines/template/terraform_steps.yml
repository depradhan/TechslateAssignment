parameters:
  - name: ringName
    type: string

steps:
  - task: TerraformInstaller@1
    displayName: 'Install Terraform Tool'
    inputs:
      terraformVersion: 'latest'

  - task: Bash@3
    displayName: 'Terraform init'
    inputs:
      targetType: 'inline'
      script: 'terraform init -backend-config="./backend/backend-${{parameters.ringName}}.tfvars"'
      workingDirectory: '$(System.DefaultWorkingDirectory)/terraform'


  - task: Bash@3
    displayName: 'Terraform Validate'
    inputs:
      targetType: 'inline'
      script: 'terraform validate -var-file="./variables/${{parameters.ringName}}.tfvars"'
      workingDirectory: '$(System.DefaultWorkingDirectory)/terraform'

  - task: Bash@3
    displayName: 'Terraform plan'
    inputs:
      targetType: 'inline'
      script: 'terraform plan -var-file="./variables/${{parameters.ringName}}.tfvars"'
      workingDirectory: '$(System.DefaultWorkingDirectory)/terraform' 


  - task: Bash@3
    displayName: 'Terraform apply'
    inputs:
      targetType: 'inline'
      script: 'terraform apply -var-file="./variables/${{parameters.ringName}}.tfvars" -auto-approve'
      workingDirectory: '$(System.DefaultWorkingDirectory)/terraform' 
